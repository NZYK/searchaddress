# 住所検索アプリケーション

## 実行環境

* Java 17.0.10 (必須)
* Gradle 8.7 (実行/ビルドに必要ですが、後述する実行方法によりインストール不要)

## 実行方法
- ### Javaのインストール
  - 実行にJavaVMが必要です。[Java17.0.10](https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html)をインストールしてください。  
  ---
  Java17より新しくても動きますが、Java18以上の場合windows環境で文字化けが発生する場合があります。  
  これは、OS別に動的にデフォルトの文字コード（win : S-JIS, unix系 : UTF-8）が設定されていた仕様がJava17を境に変更となり、Java18以降ではUTF-8をデフォルトの文字コードとして扱うようになったことに由来します。  
  本アプリケーションのソースコードはwin環境で作成され、Shift-JISにより記述されているため、UTF-8でコンパイルされると文字化けを起こしてしまいます。これを回避するためには環境変数に`JAVA_TOOL_OPTIONS=-Dfile.encoding=COMPAT`を設定することで回避できますが、面倒くさいのでJava17を使用することを強く推奨します。
- ### アプリケーションのビルド・実行  
  ### 以下コマンドをプロジェクトフォルダ上で実行してください  
  ---
  #### ビルドツールであるGradleを使って、ソースコードのビルド・実行が行えます。
  - gradlewのコマンドいずれかを実行することで、Gradleをインストールしていなくても初回起動時にプロジェクトファイル内にインストールしてくれます。(初回の実行のみ時間がかかります)
  - linux環境の場合、gradlewファイルを実行することになりますが、実行権限がないと`コマンドが見つかりません`というエラーが出てしまうので、`sudo chmod 777 gradlew`などでgradlewファイルに実行権限を付けてください。

  ---
  #### ソースの実行
  ```
  ./gradlew -q --console plain run
  ```
  `./gradlew run`で実行できます。`-q --console plain`オプションをつけることでGradlewのログを非表示にすることができます。
  
  ---
  #### アプリケーションのビルド
  ```
  ./gradlew build
  ```
  ビルド後のsearchaddress-0.1.0.jarパッケージは以下に保存されます
  ```
  searchaddress/app/build/libs/searchaddress-0.1.0.jar
  ```
  ---
  #### ビルドしたパッケージの実行
  ```
  java -jar searchaddress-0.1.0.jar
  ```

## アプリケーションの使用方法
### 初回起動時
#### 実行環境下csvディレクトリがない場合、次のメッセージを出力し、csvフォルダを作成後にアプリケーションが終了します。
```
> ./gradlew -q --console plain run
csvフォルダがありません。作成します  
csvフォルダを作成しました  

zenkoku.csvファイルがありません。csvフォルダ内に格納してください
```
gradlewで実行した場合、app配下にcsvフォルダが作成されているので、zenkoku.csvを格納してください。  
.jarを実行した場合は.jarと同じディレクトリにcsvフォルダが生成されます。

---
### csv格納後
#### csvを所定のディレクトリに格納後、再び実行すると以下のメッセージが出力されます。
```
> ./gradlew -q --console plain run
csvが存在しています
csvの読み込み完了

初回起動です。転置インデックスを生成します
転置インデックスの生成が完了しました

標準入力に使用する文字コードを選択してください
基本的に、windowsならShift-JIS、linux,macならUTF-8です
(s) Shift-JIS / (u) UTF-8 >
```
invIndex.jsonが存在していない場合、csvフォルダと同じ階層に転置インデックスが自動で生成されます。  
その後、コマンドプロンプトの文字コードを聞かれるので、メッセージに従って入力してください。  

---
### 検索画面
#### 文字コードの入力を終えると検索画面に遷移します。入力したワードで住所検索を行うことが出来ます。exitを入力するとプログラムが終了します。
```
(s) Shift-JIS / (u) UTF-8 > s

住所検索をします。キーワードを入力 (exitで終了) >
```
#### 検索実行後
```
住所検索をします。キーワードを入力 (exitで終了) > ねこ
〒771-1297　徳島県板野郡藍住町　奥野　かねこみそ　（株）　奥野乾８１?２
検索結果:1件 検索時間:1 ms

住所検索をします。キーワードを入力 (exitで終了) >
```

---